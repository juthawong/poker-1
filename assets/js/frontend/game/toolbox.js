// Generated by CoffeeScript 1.10.0
(function() {
  var constants, getAllPairValuesAtHandForSuit, getCardName, getCardValuesAtHandForSuit, globalVariables, havePairForSuit, haveSingleForSuit, haveTractorForSuit, showPlayedCardsForUser, shuffleCards, sortCards, toggleCardSelection, validateSelectedCardsForPlay;

  constants = require('./constants.js');

  globalVariables = require('./globalVariables.js');

  shuffleCards = function() {
    var array, copy, i, j, k, l, m, n, numOfIterations, ref;
    array = [];
    for (j = k = 0; k < 2; j = ++k) {
      for (i = l = 1; l < 47; i = ++l) {
        array.push(i);
      }
    }
    copy = [];
    n = array.length;
    numOfIterations = n;
    for (i = m = 0, ref = numOfIterations; 0 <= ref ? m < ref : m > ref; i = 0 <= ref ? ++m : --m) {
      j = Math.floor(Math.random() * n);
      copy.push(array[j]);
      array.splice(j, 1);
      n -= 1;
    }
    return copy;
  };

  sortCards = function(array) {
    var sortNumber;
    sortNumber = function(a, b) {
      return a - b;
    };
    return array.sort(sortNumber);
  };

  getCardName = function(n) {
    var cardName;
    cardName = '';
    switch (n) {
      case 1:
        cardName = 'bigJoker';
        break;
      case 2:
        cardName = 'smallJoker';
        break;
      case 3:
        cardName = 'sevenOfSpades';
        break;
      case 4:
        cardName = 'sevenOfHearts';
        break;
      case 5:
        cardName = 'sevenOfClubs';
        break;
      case 6:
        cardName = 'sevenOfDiamonds';
        break;
      case 7:
        cardName = 'twoOfSpades';
        break;
      case 8:
        cardName = 'twoOfHearts';
        break;
      case 9:
        cardName = 'twoOfClubs';
        break;
      case 10:
        cardName = 'twoOfDiamonds';
        break;
      case 11:
        cardName = 'aceOfSpades';
        break;
      case 12:
        cardName = 'kingOfSpades';
        break;
      case 13:
        cardName = 'queenOfSpades';
        break;
      case 14:
        cardName = 'jackOfSpades';
        break;
      case 15:
        cardName = 'tenOfSpades';
        break;
      case 16:
        cardName = 'nineOfSpades';
        break;
      case 17:
        cardName = 'eightOfSpades';
        break;
      case 18:
        cardName = 'sixOfSpades';
        break;
      case 19:
        cardName = 'fiveOfSpades';
        break;
      case 20:
        cardName = 'aceOfHearts';
        break;
      case 21:
        cardName = 'kingOfHearts';
        break;
      case 22:
        cardName = 'queenOfHearts';
        break;
      case 23:
        cardName = 'jackOfHearts';
        break;
      case 24:
        cardName = 'tenOfHearts';
        break;
      case 25:
        cardName = 'nineOfHearts';
        break;
      case 26:
        cardName = 'eightOfHearts';
        break;
      case 27:
        cardName = 'sixOfHearts';
        break;
      case 28:
        cardName = 'fiveOfHearts';
        break;
      case 29:
        cardName = 'aceOfClubs';
        break;
      case 30:
        cardName = 'kingOfClubs';
        break;
      case 31:
        cardName = 'queenOfClubs';
        break;
      case 32:
        cardName = 'jackOfClubs';
        break;
      case 33:
        cardName = 'tenOfClubs';
        break;
      case 34:
        cardName = 'nineOfClubs';
        break;
      case 35:
        cardName = 'eightOfClubs';
        break;
      case 36:
        cardName = 'sixOfClubs';
        break;
      case 37:
        cardName = 'fiveOfClubs';
        break;
      case 38:
        cardName = 'aceOfDiamonds';
        break;
      case 39:
        cardName = 'kingOfDiamonds';
        break;
      case 40:
        cardName = 'queenOfDiamonds';
        break;
      case 41:
        cardName = 'jackOfDiamonds';
        break;
      case 42:
        cardName = 'tenOfDiamonds';
        break;
      case 43:
        cardName = 'nineOfDiamonds';
        break;
      case 44:
        cardName = 'eightOfDiamonds';
        break;
      case 45:
        cardName = 'sixOfDiamonds';
        break;
      case 46:
        cardName = 'fiveOfDiamonds';
    }
    return cardName;
  };

  showPlayedCardsForUser = function(n, valuesOfPlayedCards) {
    var cardsToRemove, i, k, l, m, playedCard, ref, ref1, ref2, results, startX, startY, userPlayedCards;
    startX = null;
    startY = null;
    userPlayedCards = null;
    switch (n) {
      case 0:
        startX = globalVariables.screenWidth / 2 - (valuesOfPlayedCards.length + 3) * globalVariables.scaledCardWidth / 8;
        startY = globalVariables.screenHeight - 2 * globalVariables.scaledCardHeight - 2 * constants.MARGIN;
        userPlayedCards = globalVariables.currentUserPlayedCards;
        break;
      case 1:
        startX = globalVariables.screenWidth - (valuesOfPlayedCards.length + 3) * globalVariables.scaledCardWidth / 4 - constants.MARGIN;
        startY = globalVariables.screenHeight / 2 - globalVariables.scaledCardHeight / 2;
        userPlayedCards = globalVariables.user1PlayedCards;
        break;
      case 2:
        startX = globalVariables.screenWidth / 2 - (valuesOfPlayedCards.length + 3) * globalVariables.scaledCardWidth / 8;
        startY = constants.MARGIN;
        userPlayedCards = globalVariables.user2PlayedCards;
        break;
      case 3:
        startX = constants.MARGIN;
        startY = globalVariables.screenHeight / 2 - globalVariables.scaledCardHeight / 2;
        userPlayedCards = globalVariables.user3PlayedCards;
    }
    cardsToRemove = [];
    for (i = k = 0, ref = userPlayedCards.children.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      cardsToRemove.push(userPlayedCards.children[i]);
    }
    for (i = l = 0, ref1 = cardsToRemove.length; 0 <= ref1 ? l < ref1 : l > ref1; i = 0 <= ref1 ? ++l : --l) {
      userPlayedCards.remove(cardsToRemove[i]);
    }
    results = [];
    for (i = m = 0, ref2 = valuesOfPlayedCards.length; 0 <= ref2 ? m < ref2 : m > ref2; i = 0 <= ref2 ? ++m : --m) {
      playedCard = userPlayedCards.create(startX + i * globalVariables.scaledCardWidth / 4, startY, getCardName(valuesOfPlayedCards[i]));
      playedCard.width = globalVariables.scaledCardWidth;
      results.push(playedCard.height = globalVariables.scaledCardHeight);
    }
    return results;
  };

  toggleCardSelection = function(sprite) {
    if (!sprite.isSelected) {
      sprite.y = sprite.y - constants.SELECTED_CARD_Y_OFFSET;
    } else {
      sprite.y = sprite.y + constants.SELECTED_CARD_Y_OFFSET;
    }
    return sprite.isSelected = !sprite.isSelected;
  };

  getCardValuesAtHandForSuit = function(suitIndex, cardValuesAtHand) {
    var cardValuesAtHandOfSuit, endCardValueForSuit, i, k, ref, startCardValueForSuit;
    startCardValueForSuit = 0;
    endCardValueForSuit = 0;
    switch (suitIndex) {
      case constants.INDEX_SUIT_MAIN:
        startCardValueForSuit = constants.START_VALUE_FOR_MAIN;
        endCardValueForSuit = constants.END_VALUE_FOR_MAIN;
        break;
      case constants.INDEX_SUIT_SPADE:
        startCardValueForSuit = constants.START_VALUE_FOR_SPADE;
        endCardValueForSuit = constants.END_VALUE_FOR_SPADE;
        break;
      case constants.INDEX_SUIT_HEART:
        startCardValueForSuit = constants.START_VALUE_FOR_HEART;
        endCardValueForSuit = constants.END_VALUE_FOR_HEART;
        break;
      case constants.INDEX_SUIT_CLUB:
        startCardValueForSuit = constants.START_VALUE_FOR_CLUB;
        endCardValueForSuit = constants.END_VALUE_FOR_CLUB;
        break;
      case constants.INDEX_SUIT_DIAMOND:
        startCardValueForSuit = constants.START_VALUE_FOR_DIAMOND;
        endCardValueForSuit = constants.END_VALUE_FOR_DIAMOND;
    }
    cardValuesAtHandOfSuit = [];
    for (i = k = 0, ref = cardValuesAtHand.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      if (cardValuesAtHand[i] >= startCardValueForSuit && cardValuesAtHand[i] <= endCardValueForSuit) {
        cardValuesAtHandOfSuit.push(cardValuesAtHand[i]);
      }
    }
    return cardValuesAtHandOfSuit;
  };

  havePairForSuit = function(suitIndex, cardValuesAtHand) {
    var cardValuesAtHandOfSuit, i, k, ref;
    cardValuesAtHandOfSuit = getCardValuesAtHandForSuit(suitIndex, cardValuesAtHand);
    for (i = k = 0, ref = cardValuesAtHandOfSuit.length - 1; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      if (cardValuesAtHandOfSuit[i] === cardValuesAtHandOfSuit[i + 1]) {
        return true;
      }
    }
    return false;
  };

  haveSingleForSuit = function(suitIndex, cardValuesAtHand) {
    var cardValuesAtHandOfSuit;
    cardValuesAtHandOfSuit = getCardValuesAtHandForSuit(suitIndex, cardValuesAtHand);
    if (cardValuesAtHandOfSuit.length > 0) {
      return true;
    } else {
      return false;
    }
  };

  getAllPairValuesAtHandForSuit = function(suitIndex, cardValuesAtHand) {
    var cardValuesAtHandOfSuit, i, k, pairValues, ref;
    cardValuesAtHandOfSuit = getCardValuesAtHandForSuit(suitIndex, cardValuesAtHand);
    pairValues = [];
    for (i = k = 0, ref = cardValuesAtHandOfSuit.length - 1; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      if (cardValuesAtHandOfSuit[i] === cardValuesAtHandOfSuit[i + 1]) {
        pairValues.push(cardValuesAtHandOfSuit[i]);
      }
    }
    return pairValues;
  };

  haveTractorForSuit = function(suitIndex, tractorLength, cardValuesAtHand) {
    var i, k, numOfConsecutivePairs, pairValuesAtHandOfSuit, ref;
    pairValuesAtHandOfSuit = getAllPairValuesAtHandForSuit(suitIndex, cardValuesAtHand);
    if (pairValuesAtHandOfSuit.length < tractorLength) {
      return false;
    }
    numOfConsecutivePairs = 0;
    for (i = k = 0, ref = pairValuesAtHandOfSuit.length; 0 <= ref ? k < ref : k > ref; i = 0 <= ref ? ++k : --k) {
      if ((pairValuesAtHandOfSuit.length - i) < tractorLength) {
        return false;
      }
      if ((pairValuesAtHandOfSuit[i] + 1) === pairValuesAtHandOfSuit[i]) {
        numOfConsecutivePairs += 1;
        if (numOfConsecutivePairs === tractorLength) {
          return true;
        }
      } else {
        numOfConsecutivePairs = 0;
      }
    }
    return false;
  };

  validateSelectedCardsForPlay = function(selectedCardValues, cardValuesAtHand, firstlyPlayedCardValues) {
    if (selectedCardValues.length === 0) {
      return false;
    }
    selectedCardValues = sortCards(selectedCardValues);
    cardValuesAtHand = sortCards(cardValuesAtHand);
    return firstlyPlayedCardValues = sortCards(firstlyPlayedCardValues);
  };

  module.exports = {
    sortCards: sortCards,
    getCardName: getCardName,
    toggleCardSelection: toggleCardSelection,
    showPlayedCardsForUser: showPlayedCardsForUser,
    validateSelectedCardsForPlay: validateSelectedCardsForPlay,
    getCardValuesAtHandForSuit: getCardValuesAtHandForSuit,
    havePairForSuit: havePairForSuit,
    haveSingleForSuit: haveSingleForSuit,
    getAllPairValuesAtHandForSuit: getAllPairValuesAtHandForSuit,
    haveTractorForSuit: haveTractorForSuit,
    shuffleCards: shuffleCards
  };

}).call(this);
